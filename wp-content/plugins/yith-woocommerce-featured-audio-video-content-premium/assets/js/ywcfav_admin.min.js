jQuery(document).ready(function(e){var a,i,o={message:null,overlayCSS:{background:"#000",opacity:.6},ignoreIfBlocked:!0},d=function(e){var a=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return a&&11===a[2].length?a[2]:null},t=function(e){var a,i=e.match(/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/);return i&&(a=i[5]),a},n=function(){return"id-"+Math.random().toString(36).substr(2,16)},c=function(a,i,o,d,t){var c=e(".product_video .ywcfav_woocommerce_video"),r="ywcfav_video_"+n(),_=c.size(),v={video_type:a,video_name:d,video_content:t,video_img:o,video_id:r,video_host:i,product_id:woocommerce_admin_meta_boxes.post_id,loop:_,action:ywcfav.actions.add_new_video_row};e.ajax({type:"POST",url:ywcfav.admin_url,data:v,dataType:"json",success:function(a){e(".product_video").append(a.result),e("body").trigger("ywcfav_new_content_insert",[r,d]),e("body").trigger("ywcfav_featured_insert")}})};e(document).on("ywcfav_row_insert",function(a){e("#ywcfav_video_add_by").val("").change(),e("#ywcfav_video_add_by_id").val(""),e("#ywcfav_video_add_by_url").val(""),e("#ywcfav_video_add_by_embedded").val(""),e("#ywcfav_video_name").val(""),e("#ywcfav_video_url_up").val(""),e("#ywcfav_video_id_up").val("")}),e(document).on("ywcfav_featured_insert",function(a){e("input").removeClass("error_field"),e("select").removeClass("error_field"),e("textarea").removeClass("erorr_field")}),e(document).on("ywcfav_new_content_insert",function(a,i,d){var t=e(".ywcfav_select_featured_content"),n=e(".select_featured");t.block(o),n.append('<option value="'+i+'">'+d+"</option>"),setTimeout(function(){t.unblock()},500)}),e(document).on("ywcfav_remove_content",function(a,i){var d=e(".ywcfav_select_featured_content"),t=e(".select_featured");d.block(o),t.find('option[value="'+i+'"]').remove(),setTimeout(function(){d.unblock()},500)}),e("#ywcfav_video_add_by_upload").on("click",function(i){var o=e(this),d=e(".ywfav_add_video");if(i.preventDefault(),a)a.open();else{var t=[new wp.media.controller.Library({library:wp.media.query({type:"video"}),multiple:!1,title:o.data("choose"),priority:20,filterable:"uploaded"})];(a=wp.media.frames.downloadable_file=wp.media({title:o.data("choose"),library:{type:"video"},button:{text:o.data("choose")},multiple:!1,states:t})).on("select",function(){var i="",o="";a.state().get("selection").map(function(e){"video"==(e=e.toJSON()).type?e.url&&(i=e.url,o=e.id):alert(ywcfav.error_video)});var t=e(document).find("#ywcfav_video_url_up");e(document).find("#ywcfav_video_id_up").val(o),t.val(i),d.click()}),a.open()}}),e(document).on("click",".ywcfav_upload_image_button",function(a){var o=e(this);a.preventDefault();var d=[new wp.media.controller.Library({library:wp.media.query({type:"image"}),multiple:!1,title:o.data("choose"),priority:20,filterable:"all"})];(i=wp.media.frames.downloadable_file=wp.media({title:o.data("choose"),library:{type:"image"},button:{text:o.data("choose")},multiple:!1,states:d})).on("select",function(){var e="",a="";i.state().get("selection").map(function(i){(i=i.toJSON()).url&&(e=i.url,a=i.id,o.parent().find(".thumbn_id").val(a),o.find(".ywcfav_thumbn").attr("src",e))})}),i.open()});var r=function(a,i,o,d,t,c){var r=a.find(".ywcfav_variable_video_container"),_=r.data("loop"),v=a.find('input:hidden[name^="variable_post_id"]').val(),l={video_id:"ywcfav_video_"+n(),video_type:i,video_name:t,video_content:c,video_host:o,video_img:d,product_id:v,loop:_,action:ywcfav.actions.add_new_video_variation};e.ajax({type:"POST",url:ywcfav.admin_url,data:l,dataType:"json",success:function(i){r.html(i.result),a.find(".ywcfav_variable_video_add_container").hide(),e("body").trigger("ywcfav_featured_insert")}})};e(document).on("woocommerce_variations_loaded woocommerce_variations_added",function(){e(document).on("change",".ywcfav_variation_video_add_by",function(a){var i=e(this),o=i.val(),d=e(this).closest(".woocommerce_variation").find(".ywcfav_variable_video"),t=d.find(".variation_video_add_by_id"),n=d.find(".variation_video_add_by_url"),c=d.find(".variation_video_add_by_embedded"),r=d.find(".variation_video_add_by_upload"),_=d.find(".variation_video_type"),v=d.find(".variation_video_title"),l=d.find(".variation_video_button_add");switch(i.hasClass("error_field")&&i.removeClass("error_field"),o){case"id":v.show(),t.show(),n.hide(),c.hide(),r.hide(),_.show(),l.show();break;case"url":v.show(),t.hide(),n.show(),c.hide(),r.hide(),_.show(),l.show();break;case"embd":v.show(),t.hide(),n.hide(),c.show(),r.hide(),_.hide(),l.show();break;case"upload":v.show(),t.hide(),n.hide(),c.hide(),r.show(),_.hide(),l.hide();break;default:v.hide(),t.hide(),n.hide(),c.hide(),r.hide(),_.hide(),l.hide()}}),e(document).on("click",".ywcfav_add_variable_video",function(a){var i=e(this).parents(".woocommerce_variation"),n=i.find(".ywcfav_variation_video_add_by").val(),c="",_="",v=i.find(".ywcfav_variation_video_title"),l=v.val(),s=!1;switch(""==l&&(s=!0,v.addClass("error_field")),n){case"id":c=i.find(".ywcfav_variation_video_add_by_id"),""==(_=c.val())&&(s=!0);break;case"url":c=i.find(".ywcfav_variation_video_add_by_url"),""==(_=c.val())&&(s=!0);break;case"embd":c=i.find(".ywcfav_variation_video_add_by_embedded"),""==(_=c.val())&&(s=!0);break;case"upload":c=i.find(".ywcfav_variation_video_id"),""==(_=c.val())&&(s=!0)}if(s)c.parent().addClass("error_field"),a.preventDefault();else{var f=ywcfav.video_placeholder_img_id;if(i.block(o),"upload"==n)r(i,n,"host",f,l,_),setTimeout(function(){i.unblock()},500);else if("embd"==n)r(i,n,"embedded",f,l,encodeURI(_)),setTimeout(function(){i.unblock()},500);else{var u=i.find(".ywcfav_variation_video_type_host").val(),y="";switch(n){case"id":y=_;break;case"url":y="vimeo"==u?t(_):d(_)}var w={ywcfav_id:y,ywcfav_host:u,ywcfav_name:l,action:ywcfav.actions.save_thumbnail_video};e.ajax({type:"POST",url:ywcfav.admin_url,data:w,dataType:"json",success:function(e){f="ok"==e.result?e.id_img:ywcfav.video_placeholder_img_id,r(i,n,u,f,l,encodeURI(_)),i.unblock(),i.addClass("variation-needs-update")}})}}}),e(document).on("click",".remove_video",function(a){var i=e(this).closest(".woocommerce_variation"),d=i.find(".ywcfav_variable_video_container"),t=i.find(".ywcfav_variable_video_add_container");i.block(o),setTimeout(function(){d.html(""),i.unblock(),i.addClass("variation-needs-update"),t.find("input").val(""),t.find("select").val(""),t.show()},500)}),e(document).on("click",".ywcfav_variation_upload_image_button",function(a){var o=e(this);a.preventDefault();var d=[new wp.media.controller.Library({library:wp.media.query({type:"image"}),multiple:!1,title:o.data("choose"),priority:20,filterable:"all"})];(i=wp.media.frames.downloadable_file=wp.media({title:o.data("choose"),library:{type:"image"},button:{text:o.data("choose")},multiple:!1,states:d})).on("select",function(){var e="",a="";i.state().get("selection").map(function(i){(i=i.toJSON()).url&&(e=i.url,a=i.id,o.closest(".woocommerce_variation").find(".thumbn_id").val(a),o.closest(".woocommerce_variation").find(".ywcfav_variation_thumbn").attr("src",e),o.closest(".woocommerce_variation").addClass("variation-needs-update"))})}),i.open()}),e(document).on("click",".ywcfav_variation_video_add_by_upload",function(i){var o=e(this),d=o.parent().parent(),t=d.find(".ywcfav_variation_video_id"),n=d.find(".ywcfav_add_variable_video");i.preventDefault();var c=[new wp.media.controller.Library({library:wp.media.query({type:"video"}),multiple:!1,title:o.data("choose"),priority:20,filterable:"uploaded"})];(a=wp.media.frames.downloadable_file=wp.media({title:o.data("choose"),library:{type:"video"},button:{text:o.data("choose")},multiple:!1,states:c})).on("select",function(){var e="";a.state().get("selection").map(function(a){"video"==(a=a.toJSON()).type?a.id&&(e=a.id):alert(ywcfav.error_video)}),t.val(e),n.click()}),a.open()})}),e("body").on("ywcfav_admin_field_init",function(){!function(){var a=e("#ywcfav_video_add_by"),i=e(".ywfav_add_video");e(".ywcfav_delete");a.on("change",function(a){var i=e(this),o=i.val(),d=i.parents("#ywcfav_form_container"),t=d.find(".video_add_by_id"),n=d.find(".video_add_by_url"),c=d.find(".video_add_by_embedded"),r=d.find(".video_add_by_upload"),_=d.find(".video_type_host"),v=d.find(".video_name"),l=d.find(".ywfav_add_video");switch(i.hasClass("error_field")&&i.removeClass("error_field"),v.show(),o){case"id":t.show(),n.hide(),c.hide(),r.hide(),_.show(),l.show();break;case"url":t.hide(),n.show(),c.hide(),r.hide(),_.show(),l.show();break;case"embd":t.hide(),n.hide(),c.show(),r.hide(),_.hide(),l.show();break;case"upload":t.hide(),n.hide(),c.hide(),r.show(),_.hide(),l.hide();break;default:t.hide(),n.hide(),c.hide(),r.hide(),_.hide(),v.hide(),l.hide()}}),i.on("click",function(i){var n=a.val(),r="",_="",v=!1,l=e("#ywcfav_video_name"),s=l.val();if(""==n)return a.addClass("error_field"),void i.preventDefault();if(""==s)return l.addClass("error_field"),void i.preventDefault();switch(n){case"id":r=e("#ywcfav_video_add_by_id"),""==(_=r.val())&&(v=!0);break;case"url":r=e("#ywcfav_video_add_by_url"),""==(_=r.val())&&(v=!0);break;case"embd":r=e("#ywcfav_video_add_by_embedded"),""==(_=r.val())&&(v=!0);break;case"upload":r=e("#ywcfav_video_id_up"),""==(_=r.val())&&(v=!0)}if(v)r.parent().addClass("error_field"),i.preventDefault();else{var f=ywcfav.video_placeholder_img_id,u=e("#ywcfav_video_data");if(u.block(o),"upload"==n)c(n,"host",f,s,_),setTimeout(function(){u.unblock()},500);else if("embd"==n)c(n,"embedded",f,s,encodeURI(_)),setTimeout(function(){u.unblock()},500);else{var y=e("#ywcfav_video_type_host").val(),w="";switch(n){case"id":w=_;break;case"url":w="vimeo"==y?t(_):d(_)}var m={ywcfav_id:w,ywcfav_host:y,ywcfav_name:s,action:ywcfav.actions.save_thumbnail_video};e.ajax({type:"POST",url:ywcfav.admin_url,data:m,dataType:"json",success:function(e){f="ok"==e.result?e.id_img:ywcfav.video_placeholder_img_id,c(n,y,f,s,encodeURI(_)),u.unblock()}})}e("body").trigger("ywcfav_row_insert")}}),e(document).on("click",".ywcfav_delete",function(a){a.preventDefault();var i=e(this).parent().parent(),o=i.find(".ywcfav_video_id").val();i.remove(),e("body").trigger("ywcfav_remove_content",[o])})}(),e(".ywcfav_insert_track").on("click",function(){var a=e("#ywcfav_audio_data"),i=e("#ywcfav_audio_name"),d=e("#ywcfav_audio_url"),t=i.val(),c=d.val(),r=!1;if(""==t&&(i.addClass("error_field"),r=!0),""==c&&(d.addClass("error_field"),r=!0),!r){a.block(o);var _=e(".product_audio .ywcfav_woocommerce_audio_data"),v="ywcfav_audio_"+n(),l=_.size(),s={audio_name:t,audio_content:encodeURI(c),audio_img:ywcfav.audio_placeholder_img_id,audio_id:v,product_id:woocommerce_admin_meta_boxes.post_id,loop:l,action:ywcfav.actions.add_new_audio_row};e.ajax({type:"POST",url:ywcfav.admin_url,data:s,dataType:"json",success:function(o){e(".product_audio").append(o.result),a.unblock(),i.val(""),d.val(""),e("body").trigger("ywcfav_new_content_insert",[v,t]),e("body").trigger("ywcfav_featured_insert")}})}}),e(document).on("click",".ywcfav_delete_audio",function(a){a.preventDefault();var i=e(this).parent().parent(),o=i.find(".ywcfav_audio_id").val();i.remove(),e("body").trigger("ywcfav_remove_content",[o])})}).trigger("ywcfav_admin_field_init"),e("#ywcfav_copy_section").length&&e("#ywcfav_copy_content").on("click",function(a){a.preventDefault();var i=e(this),o={product_id:i.data("product_id"),original_id:i.data("original_product_id"),action:"ywcfav_copy_content_from_original"};e.ajax({type:"POST",url:ywcfav.admin_url,data:o,dataType:"json",beforeSend:function(){i.siblings(".ajax-loading").css("visibility","visible")},complete:function(){i.siblings(".ajax-loading").css("visibility","hidden")},success:function(e){location.reload()}})})});