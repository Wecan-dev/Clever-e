/*!
* WP Grid Builder Plugin
*
* @package   WP Grid Builder
* @author    Loïc Blascos
* @link      https://www.wpgridbuilder.com
* @copyright 2019-2020 Loïc Blascos
*
*/
!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,window.CustomEvent=e)}(),function(pe){pe(function(){"use strict";var e=window.navigator.userAgent,t=e.indexOf("MSIE");0<(t=(t=t<0?e.indexOf("Trident/"):t)<0?e.indexOf("Edge/"):t)&&pe("html").addClass("is-ie");function n(i,o,a){var r;return function(){var e=this,t=arguments,n=a&&!r;clearTimeout(r),r=setTimeout(function(){r=null,a||i.apply(e,t)},o),n&&i.apply(e,t)}}function i(e){var t=document.createElement("input");t.style.position="absolute",t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}var o;pe(document).on("click",".wpgb-copy-to-clipboard",function(){var e=pe(this);clearTimeout(o),i(e.text().trim()),WPGB_Popup_Message("shortcode","success"),pe(".wpgb-shortcode-copied").removeClass("wpgb-shortcode-copied"),e.addClass("wpgb-shortcode-copied"),o=setTimeout(function(){e.removeClass("wpgb-shortcode-copied")},1800)}),pe('input[name="wpgb[shortcode]"][disabled]').parent().on("click",function(e){e.target&&"INPUT"===e.target.tagName&&parseInt(pe('[name="wpgb_id"]').val(),10)&&(clearTimeout(o),i(e.target.value.trim()),WPGB_Popup_Message("shortcode","success"))});function a(e){var t=new Date;t.setTime(t.getTime()-1),document.cookie=e+"=; expires="+t.toGMTString()}function r(e){for(var t,n=decodeURIComponent(window.location.search.substring(1)).split("&"),i=0;i<n.length;i++)if((t=n[i].split("="))[0]===e)return"undefined"===t[1]||t[1]}pe(document).on("submit","#wpgb form",function(){return!1});pe(document).on("change",".wpgb-select-item",function(){var e,t,n=pe(this),i=pe(".wpgb-select-item:not(#wpgb-bulk-select)");n.is("#wpgb-bulk-select")?(e=n.prop("checked"),i.prop("checked",e)):(t=i.length,e=i.serializeArray().length,pe("#wpgb-bulk-select").prop("checked",t===e))}),pe("#wpgb_form").submit(function(e){e.preventDefault()});function s(t,e,n){e=pe.extend({},t,e),p&&JSON.stringify(t)===JSON.stringify(c)&&p.abort(),c=t,p=pe.ajax({url:ajaxurl,type:"POST",data:e,dataType:"json",beforeSend:function(e){n&&n.hasOwnProperty("before")&&n.before&&n.before(e),WPGB_Popup_Message(t.method,"loading")},error:function(e,t){"abort"!==t&&(n&&n.hasOwnProperty("error")&&n.error&&(e.success=!1,n.error(e)),WPGB_Popup_Message("unknown","error"),console.error(e))},success:function(e){n&&n.hasOwnProperty("success")&&n.success&&n.success(e),WPGB_Popup_Message(t.method,e.success?"success":"error",e.message)}})}var c,p=null;pe(document).on("keyup",".wpgb-import-list-search input",function(){var t=0,e=pe(".wpgb-list-item:not([hidden])"),n=pe(".wpgb-import-list-number"),i=pe(this).val();e.each(function(){var e=pe(this);0<=e.find("span").text().toLowerCase().indexOf(i)?(t++,e.show()):e.hide()}),pe(".wpgb-list-no-result")[0===t?"show":"hide"](),n.text(t+" "+n.data(1<t?"plural":"singular"))});var d=pe(".wpgb-uploader"),l=pe(".wpgb-uploader-message"),g=pe(".wpgb-uploader-remove"),u=pe(".wpgb-uploader-message").text();g.on("click",function(){pe(".wpgb-import-list").remove(),g.attr("tabindex","-1"),w.removeAttr("tabindex")});function b(e){if(e){var t=new FormData,n=encodeURIComponent(r("username")),i=encodeURIComponent(r("password"));t.append("import",e),t.append("action","wpgb_import"),t.append("nonce",pe("#wpgb_upload_field").val()),t.append("method","read_file"),t.append("object","upload"),t.append("wpgb","read_file"),t.append("auth",window.btoa(n+":"+i)),l.text(wpgb_popup_L10n.read_file),pe(".wpgb-import-list").remove(),pe.ajax({url:ajaxurl,type:"POST",contentType:!1,processData:!1,dataType:"json",data:t,context:pe(this),success:function(e){e.content?(d.prepend(e.content.list),f=e.content.data,l.text(u),w.attr("tabindex","-1"),g.removeAttr("tabindex")):(l.text(e.message),setTimeout(function(){l.text(u)},2e3))},error:function(e,t){"abort"!==t&&(l.text(wpgb_popup_L10n.unknown),setTimeout(function(){l.text(u)},2e3),console.error(e))}})}}d.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}),d.on("dragover dragenter",function(){d.addClass("wpgb-is-dragover")}),d.on("dragleave dragend drop",function(){d.removeClass("wpgb-is-dragover")}),d.on("drop",function(e){var t=e.originalEvent.dataTransfer.files;t[0]&&(pe(".wpgb-import-list").remove(),b(t[0]))});var w=pe(".wpgb-file-input");w.change(function(){var e=w[0].files[0];e&&(b(e),pe(this).val(""))}),pe(document).on("click",".wpgb-import-items",function(){var e=pe(".wpgb-import-list input").WPGB_SerializeForm();if(Object.keys(e).length){e=JSON.stringify(e);var t=pe(".wpgb-dashboard-page").length,n={data:f,demo:pe(this).data("demo"),types:e};J(),s({nonce:pe(this).data("nonce"),action:"wpgb_import",method:"import",object:"content",symbol:""},n,{before:"",success:t?"":H,error:t?"":H})}else WPGB_Popup_Message("no_selection","error")});var m,f="";pe(".wpgb-browse-demo").on("click",function(){var e=pe(this);pe(".wpgb-import-list").remove(),l.text(wpgb_popup_L10n.read_file),s({nonce:pe("#wpgb_upload_field").val(),action:"wpgb_import",method:"browse_demo",object:"upload",symbol:""},{demo:e.data("demo")},{success:function(e){e.content?(f=e.content.data,d.prepend(e.content.list),l.text(u),w.attr("tabindex","-1"),g.removeAttr("tabindex")):(l.text(e.message),setTimeout(function(){l.text(u)},2e3))},error:function(e,t){"abort"!==t&&(l.text(wpgb_popup_L10n.unknown),setTimeout(function(){l.text(u)},2e3),console.error(e))}})});function _(e,t){window.clearInterval(m),a("wpgb_items_exported");var n={action:"wpgb_export",page:r("page"),type:e,nonce:wpgb_L10n.export,ids:t},i=document.createElement("a");i.href="admin-post.php?"+pe.param(n),document.body.appendChild(i),i.click(),document.body.removeChild(i);var o=(new Date).getTime();m=window.setInterval(function(){var e=(new Date).getTime()-o,t=function(e){var t=("; "+document.cookie).split("; "+e+"=");if(2==t.length)return t.pop().split(";").shift()}("wpgb_items_exported");if(t||3e3<=e){var n=void 0!==t&&"false"!==t?decodeURIComponent(t).replace(/\+/g," "):"";WPGB_Popup_Message(null,"success",n),window.clearInterval(m),a("wpgb_items_exported")}},50)}pe(document).on("click",".wpgb-bulk-export button",function(){var e=pe(this).prev().find("select").val();e?(WPGB_Popup_Message("processing","loading"),setTimeout(function(){_(e,-1)},10)):WPGB_Popup_Message("no_content","error")});var v="";pe(document).on("submit",".wpgb-dashboard-page form",function(e){e.preventDefault(),pe('[data-method="activate_plugin"]').click()}),pe(document).on("click",".wpgb-input-submit-wrapper",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),pe(this).closest("form").submit()}),pe(document).on("click",'[data-method="activate_plugin"], [data-method="deactivate_plugin"], [data-method="refresh_status"]',function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=pe(this).data("method"),n=t.replace("_plugin","").replace("_status",""),i=pe("#wpgb_plugin_"+n+"_field").val()||pe(this).data("nonce"),o={page:window.location.href,license_email:pe('input[name="license_email"]').val(),license_key:pe('input[name="license_key"]').val()};v=pe(this).closest(".wpgb-admin-panel"),s({nonce:i,action:"wpgb_plugin",method:t,object:n,symbol:""},o,{success:y,error:""})});function h(e){if(e.content){var t=P&&P[0]&&document.activeElement===P[0];pe(".wpgb-admin-panel").replaceWith(e.content),t&&pe(".wpgb-admin-panel").find('[data-slug="'+P.data("slug")+'"]').focus()}}var y=function(e){!e.success&&pe("#wpgb-license-email").length||e.content&&v.html(e.content)},P="";pe(document).on("click",".wpgb-add-ons-card button",function(e){e.preventDefault();var t=P=pe(this),n=t.data("method")+"_addon",i=n,o=t.data("name").replace(/^\s+|\s+$/g,"").toLowerCase().replace(".","-").replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/\//g,""),a=t.data("nonce"),r={slug:t.data("slug"),name:t.data("name")};t.text(wpgb_popup_L10n["install"===t.data("method")?"installing":"activating"]),t.addClass("wpgb-loading"),s({nonce:a,action:"wpgb_plugin",method:n,object:i,symbol:o},r,{success:h,error:h})}),pe(document).on("click",".wpgb_global_settings_form .wpgb-settings-header button",function(e){e.preventDefault();var t=pe(this).data("action");WPGB_Dialog(wpgb_dialog_L10n[t],function(){if("export"===t)WPGB_Popup_Message("processing","loading"),setTimeout(function(){_("settings",-1)},10);else{"save"===t?WPGB_Popup_Message("save_changes","loading"):WPGB_Popup_Message("reset_settings","loading");var e=pe("form#wpgb_form").WPGB_SerializeForm().wpgb;s({nonce:pe("#wpgb_fields_nonce").val(),action:"wpgb_global",method:t,object:"settings",symbol:""},{type:"settings",settings:JSON.stringify(e)},{success:k,error:null})}})});function x(){W.addClass("wpgb-loading"),s({nonce:pe('[data-action="clear_index"]').data("nonce"),action:"wpgb_global",method:"index_stats",object:"settings",symbol:"clear_index"},null,{success:function(e){W.removeClass("wpgb-loading"),W.html(e.content)},error:null})}var k=function(e){if(e.content){var t=pe('[aria-selected="true"]').index();pe("form#wpgb_form").replaceWith(e.content),pe(".wpgb-settings-tabs ul li").eq(t).trigger("click"),pe.WPGB_Conditional_Logic(),WPGB_Tooltip_Init(),WPGB_Select_Init(),WPGB_Gradient_Init()}},W=pe(".wpgb-index-stats"),G=W.html();W.length&&x(),pe(document).on("click",'[data-action="clear_cache"], [data-action="delete_stylesheets"], [data-action="stop_indexer"], [data-action="clear_index"]',function(e){e.preventDefault();var t=pe(this).data("action");s({nonce:pe(this).data("nonce"),action:"wpgb_global",method:t,object:"settings",symbol:t},null,{success:function(){"clear_index"===t&&(W.html(G),x())},error:null})}),pe(document).on("click",'.wpgb_grid_settings_form [data-action="save"]',function(e){e.preventDefault(),WPGB_Popup_Message("save_changes","loading");var t=pe("form#wpgb_form").WPGB_SerializeForm().wpgb;for(var n in t.grid_layout){var i=t.grid_layout[n].style,o=t.grid_layout[n].facets;for(var a in i)""===i[a]&&delete i[a];Object.keys(i).length||o||delete t.grid_layout[n]}t={name:t.name,type:t.type,source:t.source,settings:t},s({nonce:pe("#wpgb_fields_nonce").val(),action:"wpgb_grid",method:"save",object:"settings",symbol:""},{type:"grids",id:pe('[name="wpgb_id"]').val(),settings:JSON.stringify(t)},{success:function(e){if(e.success||e.message){if(WPGB_Popup_Message("save_changes",e.success?"success":"error",e.message),window.history&&window.history.pushState&&e.content){var t=WPGB_Query_String.set({create:"",id:e.content});window.history.replaceState({},"",t),pe('[name="wpgb_id"]').val(e.content),pe('[name="wpgb[id]"]').val("wpgb-grid-"+e.content),pe('[name="wpgb[shortcode]"]').val('[wpgb_grid id="'+e.content+'"]')}}else WPGB_Popup_Message("unknown","error")},error:null})});var B=pe('[name="wpgb[slug]"]'),C=!(!B||!B[0]||""!==B[0].value);pe(document).on("input",'[name="wpgb[name]"]',function(e){var t=pe('[name="wpgb[slug]"]')[0],n=this.value;C&&(t.value=S(n))}),pe(document).on("change",'[name="wpgb[slug]"]',function(e){var t=this.value.trim();C=!t||(this.value=S(t),!1)});var S=function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")).replace(/(<([^>]+)>)/gi,"")).replace(/</g,"")).replace(/>/g,"")).replace(/%/g,"")).toLowerCase()).replace(/&.+?;/g,"",e)).replace(".","_",e)).replace(/[^%a-z0-9 _-]/g,"",e)).replace(/\s+/g,"_",e)).replace(/-\s*$/,"")).replace("-","_")};pe(document).on("click",'.wpgb_facet_settings_form [data-action="save"]',function(e){e.preventDefault(),pe('[name="wpgb[name]"]').trigger("input"),WPGB_Popup_Message("save_changes","loading");var n=pe("form#wpgb_form").WPGB_SerializeForm().wpgb;n={slug:n.slug,name:n.name,type:n.type,source:n.source,settings:n},s({nonce:pe("#wpgb_fields_nonce").val(),action:"wpgb_facet",method:"save",object:"settings",symbol:""},{type:"facets",id:pe('[name="wpgb_id"]').val(),settings:JSON.stringify(n)},{success:function(e){if(e&&(e.success||e.message)){if(WPGB_Popup_Message("save_changes",e.success?"success":"error",e.message),window.history&&window.history.pushState&&e.content){var t=WPGB_Query_String.set({create:"",id:e.content.id});window.history.replaceState({},"",t),pe('[name="wpgb_id"]').val(e.content.id),pe('[name="wpgb[id]"]').val("wpgb-facet-"+e.content.id),pe('[name="wpgb[shortcode]"]').val('[wpgb_facet id="'+e.content.id+'" grid="0"]'),"string"==typeof e.content.index?I(e.content.index,n.slug):e.content.index&&A(e.content.id)}}else WPGB_Popup_Message("unknown","error")},error:null})});var j,T=pe('button[data-action="index"], button[data-action="index_all"]'),L=pe("title"),M=T.html(),E=L.html();pe('button[data-action="index"]').on("click",function(){var e=pe('[name="wpgb_id"]').val();e&&A(e)}),pe('button[data-action="index_all"]').on("click",function(){A(-1)});function O(e){s({nonce:wpgb_L10n.index,action:"wpgb_index",method:"get_progress",object:"facets",symbol:""},{id:e},{success:function(e){if(clearTimeout(j),e.content.message){var t=e.content.progress,n=e.content.message;t=parseFloat(t).toFixed(1),T.addClass("wpgb-indexing"),T.html(n),L.html(n),T.css("background-size",t+"% 100%")}else M!==T.html()&&(T.removeClass("wpgb-indexing"),T.css("background-size",""),T.html(wpgb_popup_L10n.indexing_complete),L.html(wpgb_popup_L10n.indexing_complete)),j=setTimeout(function(){T.html(M),L.html(E)},2500),clearInterval(D)},error:function(e){}})}var D,I=function(e,t){s({nonce:wpgb_L10n.index,action:"wpgb_index",method:"update_slug",object:"facets",symbol:""},{old_slug:e,new_slug:t},{success:function(e){},error:function(e){}})},z=0,A=function(t){0<z&&Date.now()-z<750||(z=Date.now(),T.addClass("wpgb-indexing"),T.css("background-size",""),T.html(-1===t?wpgb_popup_L10n.indexing_start:wpgb_popup_L10n.check_index),s({nonce:wpgb_L10n.index,action:"wpgb_index",method:"index",object:"facets",symbol:""},{id:t},{success:function(e){e.content||-1===t?(T.html(wpgb_popup_L10n.indexing_start),L.html(wpgb_popup_L10n.indexing_start)):(T.html(wpgb_popup_L10n.pending_index),L.html(wpgb_popup_L10n.pending_index)),clearInterval(D),N(t)},error:function(e){}}))},N=function(e){O(e),D=setInterval(function(){O(e)},2e3)};pe('button[data-action="index_all"]').length&&N(-1);var F={},J=function(e,t){F={paged:1,s:pe(".wpgb-list-table-search input").val()||"",order:pe(".wpgb-sorting-active").data("order")||"DESC",orderby:pe(".wpgb-sorting-active").data("orderby")||"modified_date",limit:pe(".wpgb-list-table-per-page").val()||10,type:pe(".wpgb-list-table-header").data("type")}};J(),pe(document).on("click",".wpgb-list-table-indicators [data-orderby]:not(.wpgb-sorting-active)",function(){F.paged=1,F.order=pe(this).data("order"),F.orderby=pe(this).data("orderby"),K()}),pe(document).on("click",".wpgb-list-table-page[data-page]:not(.wpgb-list-table-current-page)",function(){pe(this).data("page")&&(F.paged=pe(this).data("page"),K())}),pe(document).on("change",".wpgb-list-table-per-page",function(){var e=pe(this).val();e!==F.limit&&(F.paged=1,F.limit=e,K())}),pe(document).on("keyup",".wpgb-list-table-search input",n(function(){var e=F.s.trim();F.paged=1,F.s=pe(this).val().trim(),e!==F.s&&K()},200)),pe(document).on("click",".wpgb-list-table-wrapper [data-action]",function(){R(pe(this).data("nonce"),pe(this).data("action"),pe(this).closest("[data-id]").data("id"))}),pe(document).on("click",".wpgb-list-table-bulk-actions button",function(){var e=pe("input.wpgb-select-item:checked:not(#wpgb-bulk-select)").map(function(){return pe(this).val()}).get();R(pe("#wpgb_actions_nonce").val(),pe(this).prev().find("select").val(),X||e)});function U(){ne(JSON.stringify({paged:1,order:"DESC",orderby:"modified_date",limit:100,type:"cards",s:pe("#wpgb-search-card").val(),is_selector:1}),"overview"),pe(".wpgb-grid-preview-header ul").hide(),pe(".wpgb-grid-preview-header .wpgb-grid-preview-update").hide(),pe(".wpgb-grid-preview-header .wpgb-search-field").show(),pe(".wpgb-grid-preview-header .wpgb-search-field input").focus()}var Q,R=function(e,t,n){t?"preview"!==t?!n||n.length<1?WPGB_Popup_Message("no_selection","error"):(F.ids=n,F.paged=1,WPGB_Dialog(wpgb_dialog_L10n[t],function(){WPGB_Popup_Message("processing","loading"),"export"===t?setTimeout(function(){_(F.type,n)},10):pe.ajax({url:ajaxurl+"?"+pe.param(F),type:"POST",data:{nonce:e,action:"wpgb_actions",method:t,object:pe(".wpgb-list-table-header").data("type"),symbol:Array.isArray(n)?"bulk":t+"_"+n,type:F.type,ids:n},dataType:"json",beforeSend:function(e){q(t,n),WPGB_Popup_Message(t,"loading")},error:function(e,t){"abort"!==t&&(H(e),WPGB_Popup_Message("unknown","error"),console.error(e))},success:function(e){H(e),WPGB_Popup_Message(t,e.success?"success":"error",e.message)}})})):ne(Z=n,"grid"):WPGB_Popup_Message("no_action","error")},q=function(e,t){if(t){Array.isArray(t)||(t=String(t).split());var n="",i=pe(".wpgb-list-table-rows");switch(e){case"delete":n="wpgb-delete-item";break;case"duplicate":n="wpgb-duplicate-item";break;case"favorite":n="wpgb-favorite-item"}pe('iframe[name="wpgb_preview"]').length&&(i=pe('iframe[name="wpgb_preview"]').contents()),t.forEach(function(e){i.find('[data-id="'+e+'"]').addClass(n)})}},$="",H=function(e){if(pe(".wpgb-list-table-rows").removeClass("wpgb-loading"),pe(".wpgb-list-table-rows li").removeClass("wpgb-delete-item wpgb-duplicate-item wpgb-favorite-item"),e.success){var t=pe("#wpgb-admin-content"),n=pe(".wpgb-list-table-wrapper"),i=pe(e.content).find(".wpgb-list-table-wrapper").html();!e.content||$===e.content&&!te||i&&n.length?i&&($!==i||te)&&(n.html(i),$=i):(t.html(e.content),$=e.content),F.type=pe(".wpgb-list-table-header").data("type"),WPGB_Tooltip_Init(),WPGB_Select_Init(),ie()}},K=function(e){pe(".wpgb-list-table-rows").addClass("wpgb-loading");var t={nonce:pe('input[name="wpgb_actions_nonce"]').val(),action:"wpgb_actions",method:"query",object:pe(".wpgb-list-table-header").data("type"),symbol:"bulk",type:F.type};Q&&Q.abort(),Q=pe.ajax({url:ajaxurl+"?"+pe.param(F),type:"POST",data:t,dataType:"json",beforeSend:function(e){q(t.action),WPGB_Popup_Message(t.method,"loading")},error:function(e,t){"abort"!==t&&(H(e),WPGB_Popup_Message("unknown","error"),console.error(e))},success:function(e){H(e),WPGB_Popup_Message(t.method,e.success?"success":"error",e.message)}})},V=null;pe("button.wpgb-select-card").on("click",function(){V=pe(this),U()}),pe(document).on("keyup","#wpgb-search-card",n(function(){pe(".wpgb-grid-preview-inner iframe").remove(),U()},200)),window.addEventListener("wpgb_preview_select_card.wpgb",function(e){var t=V.prev().find("select");if(!t.find('option[value="'+e.detail.id+'"]').length){var n=document.createElement("option");n.value=e.detail.id,n.text=e.detail.name,t[0].add(n,null)}pe(".wpgb-grid-preview-close").click(),t.val(e.detail.id).trigger("change")}),pe(document).on("change",'[name="wpgb[type]"], select[name*="wpgb[cards]"]',function(){ee()});var X,Y,Z,ee=function(){var e=pe('[name="wpgb[type]"]:checked').val(),t=pe('select[name*="wpgb[cards]"]').map(function(){return this.value}).get().filter(function(e,t,n){return""!==e&&t===n.indexOf(e)});s({nonce:pe("#wpgb_fields_nonce").val(),action:"wpgb_grid",method:"check_type",object:"settings",symbol:""},{type:e,cards:t.length?t:[0]},{before:function(){},success:function(e){pe(".wpgb-nota-grid-type.wpgb-warning").remove(),e.content&&(pe("#wpgb-cards-tab > .wpgb-admin-section:nth-child(1)").append(e.content),pe('[name="wpgb[type]"').closest(".wpgb-admin-section").append(e.content))}})};pe('select[name*="wpgb[cards]"]').length&&ee();var te=pe(".wpgb-cards-page").length,ne=function(e,t){var n={action:"wpgb_preview",method:"preview",nonce:wpgb_L10n.preview,type:t,settings:e},i=document.createElement("iframe");i.name="wpgb_preview",pe(".wpgb-grid-preview-inner").append(i);var o=document.createElement("form");for(var a in o.method="post",o.target="wpgb_preview",o.action=wpgb_L10n.preview_action,n){var r=document.createElement("input");r.setAttribute("name",a),r.setAttribute("value",n[a]),o.appendChild(r)}document.body.appendChild(o),o.submit(),o=document.body.removeChild(o),o=null,pe('iframe[name="wpgb_preview"]').css("opacity",0),pe(".wpgb-grid-preview-header").removeClass("wpgb-grid-preview-small"),pe(".wpgb-grid-preview-holder").show(),pe(".wpgb-list-table-cards").show(),pe(".wpgb-preloader").show(),pe(".wpgb-grid-preview-header ul").removeAttr("style"),pe(".wpgb-grid-preview-header .wpgb-grid-preview-update").removeAttr("style"),pe(".wpgb-grid-preview-header .wpgb-search-field").hide()},ie=function(){if(te&&pe(".wpgb-list-table-cards .wpgb-grid-preview-inner").length)return pe(".wpgb-list-table-noresult").length?(pe(".wpgb-grid-preview-inner iframe").remove(),void pe(".wpgb-list-table-cards").hide()):void ne(JSON.stringify(F),"overview")};ie(),pe(document).on("click",'.wpgb_grid_settings_form [data-action="preview"]',function(e){e.preventDefault();var t=pe('[name="wpgb_id"]').val(),n=pe("form#wpgb_form").WPGB_SerializeForm().wpgb;n.id=0<t?t:"preview",Z=JSON.stringify(n),pe('iframe[name="wpgb_preview"]').remove(),ne(Z,"grid")}),pe(document).on("click",".wpgb-grid-preview-close, .wpgb-grid-preview-overlay",function(){se(),pe(".wpgb-grid-preview-holder").hide(),pe('iframe[name="wpgb_preview"]').css("opacity",0),pe(".wpgb-grid-preview-header li").removeClass("wpgb-active"),pe(".wpgb-grid-preview-header li:first-child").addClass("wpgb-active"),pe(".wpgb-grid-preview-inner").css("maxWidth","1920px"),pe('iframe[name="wpgb_preview"]').remove()}),pe(document).on("click",".wpgb-grid-preview-update",function(){se(),pe('iframe[name="wpgb_preview"]').remove(),ne(Z,"grid")}),pe(document).on("click",".wpgb-grid-preview-header li",function(e){var t=pe(this).index(),n=Y?Object.keys(Y):[1920,1200,980,768,480,320];n.sort(function(e,t){return t-e});var i=Math.min(1920,n[t]);pe(".wpgb-grid-preview-inner iframe")[0].style.transition="none",pe(".wpgb-grid-preview-inner iframe")[0].style.opacity=0,pe(".wpgb-grid-preview-header li").removeClass("wpgb-active"),pe(".wpgb-grid-preview-header")[i<380?"addClass":"removeClass"]("wpgb-grid-preview-small"),pe(".wpgb-grid-preview-inner").css("maxWidth",i+"px"),pe(this).addClass("wpgb-active"),setTimeout(function(){requestAnimationFrame(function(){pe(".wpgb-grid-preview-inner iframe")[0].style.transition="",pe(".wpgb-grid-preview-inner iframe")[0].style.opacity=1})},150)}),pe(document).on("change","#wpgb-bulk-select",function(){var e=new CustomEvent("wpgb_preview_select_all.wpgb",{detail:pe(this).prop("checked")||""});window.dispatchEvent(e)});function oe(){if(!pe(".wpgb-grid-preview-holder").length){var e=pe('iframe[name="wpgb_preview"]');e.height(e.contents().find("html").outerHeight(!0))}}window.addEventListener("wpgb_preview_loaded.wpgb",function(e){Y=e.detail?e.detail.cardSizes:null,pe(".wpgb-preloader").hide(),pe('iframe[name="wpgb_preview"]').css("opacity",1),pe('iframe[name="wpgb_preview"]').on("load",function(){oe(),pe(this).contents().on("click",function(){pe('iframe[name="wpgb_preview"]')[0].contentWindow.focus()})})}),window.addEventListener("wpgb_preview_resized.wpgb",function(e){oe()}),window.addEventListener("wpgb_preview_select_item.wpgb",function(e){X=e.detail.ids,pe("#wpgb-bulk-select").prop("checked",e.detail.total===e.detail.selected)}),window.addEventListener("wpgb_preview_edit_item.wpgb",function(e){"_blank"===e.detail.target?window.open(e.detail.url,"_blank").focus():window.location.href=e.detail.url}),window.addEventListener("wpgb_preview_action.wpgb",function(e){e.detail.action&&(pe(window).focus(),"edit"===e.detail.action?ce(e.detail.nonce,e.detail.type,e.detail.id):R(e.detail.nonce,e.detail.action,e.detail.id))});var ae=null,re=null,se=function(){pe(".wpgb-grid-preview-holder").removeAttr("data-disabled"),pe(".wpgb-card-settings-holder").remove()},ce=function(e,t,n){n&&t&&(ae=n,re=t,WPGB_Popup_Message("processing","loading"),s({nonce:e,action:"wpgb_fields",method:"render_fields",object:"edit",symbol:n},{id:n,type:t},{before:function(){se()},success:function(e){if(e.content){var t=pe(e.content);t.find("#wpgb_fields_nonce").remove(),pe(".wpgb-grid-preview-holder").attr("data-disabled",""),pe(".wpgb-grid-preview-holder").append(t),WPGB_Select_Init(),WPGB_Tooltip_Init(),WPGB_Gradient_Init(),jQuery.WPGB_Conditional_Logic();var n=t.find(".wpgb-gallery");n.length&&n.sortable({items:"> li:not(:first-child)",placeholder:"wpgb-image",revert:0}).disableSelection()}else WPGB_Popup_Message("unknown","error")}}))};pe(document).on("click",".wpgb-card-settings-holder",function(e){e.target&&e.target.classList.contains("wpgb-card-settings-close")&&se(),e.target&&e.target.classList.contains("wpgb-card-settings-holder")&&se()}),pe(document).on("click",".wpgb-card-settings-holder button:first-of-type",function(e){if(ae){var t=pe('.wpgb-card-settings *:not([name="wpgb_fields_nonce"])').WPGB_SerializeForm().wpgb;WPGB_Popup_Message("processing","loading"),s({nonce:pe(this).data("nonce"),action:"wpgb_fields",method:"save_fields",object:"save",symbol:ae},{id:ae,type:re,meta:JSON.stringify(t)},{before:function(){},success:function(e){e.content||WPGB_Popup_Message("unknown","error")}})}}),pe(document).on("click",'.wpgb-nota-bene a[href*="&tab=card-styles"]',function(e){e.preventDefault(),pe(".wpgb-card-styles-tab").click()})})}(jQuery);