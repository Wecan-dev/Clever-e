/*!
* WP Grid Builder Plugin
*
* @package   WP Grid Builder
* @author    Loïc Blascos
* @link      https://www.wpgridbuilder.com
* @copyright 2019-2020 Loïc Blascos
*
*/
!function(n){"use strict";n.WPGB_Conditional_Logic=function(e){function t(){for(var e=[],t=document.querySelectorAll('#wpgb input:not([type="range"]):not(.wp-color-picker):not(.wpgb-range-slider-value):not(.wpgb-color-picker-input), #wpgb select, #wpgb textarea'),n=document.querySelectorAll('#wpgb [class^="wpgb"][data-field-condition]'),a=0,i=t.length;a<i;a++){var r=t[a];if(r.name){var o,l=r.name.match(/wpgb\[(.*)\]/)?r.name.match(/wpgb\[(.*)\]/)[1].replace("][",""):r.name,s=e[l];if("checkbox"===r.type)o=r.checked?r.value:0;else if("radio"===r.type)o=r.checked?r.value:"";else if(r.multiple&&"SELECT"===r.tagName){o=[];for(var c=r.children,p=0,u=c.length;p<u;p++)c[p].selected&&c[p].value&&o.push(c[p].value)}else o=r.value;o&&!r.multiple&&-1<r.name.indexOf("[]")?(e[l]||(e[l]=[]),e[l].push(o)):s&&!o||(e[l]=o)}}for(a=0,i=n.length;a<i;a++){var g,d=n[a];d.condition?g=d.condition:(g=d.getAttribute("data-field-condition"),d.condition=g,d.setAttribute("data-field-condition","")),g=JSON.parse(g),d.style.display=m(g,e)?"block":"none"}}var m=function(e,t){if("object"!=typeof e)return 0;var n=0,a=0;for(var i in e)e.hasOwnProperty(i)&&"object"==typeof(i=e[i])&&(n+=(i.field?r:m)(i,t),a++);return n===a||"OR"===(e.relation||"").toUpperCase()&&0<n?1:0},r=function(e,t){var n=t[e.field],a=e.value;switch((e.compare||"").toUpperCase()){case"CONTAINS":return n&&a&&-1<n.toString().indexOf(a.toString());case"IN":return-1<a.indexOf(n);case"NOT IN":return a.indexOf(n)<0;case"==":return n==a;case"===":return n===a;case"!=":return n!=a;case"!==":return n!==a;case">":return a<n;case">=":return a<=n;case"<":return n<a;case"<=":return n<=a;default:return!1}};return t(),e&&n(document).on("change",'#wpgb input:not([type="range"]):not(.wp-color-picker):not(.wpgb-range-slider-value):not(.wpgb-color-picker-input), #wpgb select, #wpgb textarea',t),this}}(jQuery),function(p){"use strict";p.WPGB_Conditional_Logic(!0),window.addEventListener("wpgb_builder.render_field",function(){p.WPGB_Conditional_Logic()});function r(e){var t;"function"==typeof Event?(t=new Event("change",{bubbles:!0}),e.dispatchEvent(t)):document.createEvent?((t=document.createEvent("HTMLEvents")).initEvent("change",!0,!0),e.dispatchEvent(t)):((t=document.createEventObject()).eventType="change",e.fireEvent("on"+t.eventType,t))}p(document).on("click",".wpgb-settings-collapse",function(){var e=p(this).val();"wpgb_settings_collapsed"===e?p(".wpgb-settings").parent().toggleClass("wpgb-settings-collapsed"):p(".wpgb-builder-header").toggleClass("wpgb-settings-collapsed"),document.cookie=e+"="+(p(this).prop("checked")?1:0)}),p(document).on("click",".wpgb-image:first-child",function(){var l=p(this),s=l.is("li"),c=wp.media({id:"wpgb-media-popup",frame:"select",library:{type:s?l.parent(".wpgb-gallery").data("mime-type"):"image"},multiple:!!s&&"add"});c.on("open",function(){var e=[],t=c.state().get("selection");l.closest(".wpgb-field-input").find("input").each(function(){e.push(p(this).val())});var n=wp.media.query({posts_per_page:-1,post__in:e});n.more().done(function(){t.add(n.models)})}).on("select",function(){var n,a,i,r,o=document.createDocumentFragment(),e=c.state().get("selection");l.closest(".wpgb-gallery").find("li").not(l).remove(),e.each(function(e,t){r=l,s&&e.id&&((r=l.clone(!0)).removeAttr("title"),r.removeAttr("mime-type"),r.find(".wpgb-plus-icon").remove(),r.find(".wpgb-image-filename").remove(),o.appendChild(r[0])),a=(a=e.get("sizes"))?a.medium||a.thumbnail||a.full:null,i=a?a.url:e.get("url"),"image"!==e.get("type")&&(i=(i=e.get("thumb"))?i.src:null,n=e.get("filename"),i=i||(!(i=e.get("icon"))||-1<i.indexOf("images/media/")?"":i),n&&r.append('<span class="wpgb-image-filename">'+n+"</span>")),r.find("input").val(e.id),r.find(".wpgb-image-background").css("background-image",i?"url("+i+")":"")}),p(o).insertAfter(l),c.detach(),c.dispose(),l.find("input").first().trigger("change")}).on("close",function(){c.detach(),c.dispose()}).open()}),p(document).on("click",".wpgb-image-delete",function(e){e.preventDefault(),e.stopPropagation();var t=p(this).closest(".wpgb-image");if(t.is("li")){var n=t.parent();t.remove(),n.find("input").first().trigger("change")}else t.find("input").val("").trigger("change"),t.find(".wpgb-image-background").removeAttr("style")});var o,e=p(".wpgb-gallery");e.length&&e.sortable({items:"> li:not(:first-child)",placeholder:"wpgb-image",revert:150}).disableSelection(),p(document).on("click",".wpgb-upload-media",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=p(this).prev("input"),n=wp.media({library:{type:p(this).data("mime-type")}}).on("select",function(){t.val(n.state().get("selection").first().get("url")),r(t[0]),n.detach(),n.dispose()}).on("close",function(){n.detach(),n.dispose()}).open()});function l(e,t,n){var a=parseFloat(e.value.replace(",","."));if(n&&(""===a||null===a||isNaN(a)))return"";var i=parseFloat(t.min||t.getAttribute("data-min"))||0,r=parseFloat(t.max||t.getAttribute("data-max"))||0,o=parseFloat(t.step)||1,l=Math.floor(o)!==o?o.toString().split(".")[1].length:0;return a=isNaN(a)?0:parseFloat(a),a=Math.max(i,Math.min(r,a)),a=parseFloat(a.toFixed(l))}function s(e,t){var n=JSON.parse(t.getAttribute("data-units"));if(!Array.isArray(n)||!n)return"";var a=n.filter(function(e){return e}),i=new RegExp(a.join("|"),"gi"),r=e.value.toString().match(i);return r=a.length===n.length||r?r?r.shift():n[0]:"",t.wpgb_unit=r,c(t,r,n),r}var c=function(e,t,n){var a=n.indexOf(t)||0,i=JSON.parse(e.getAttribute("data-steps")),r=Array.isArray(i)?i[a]:1;e.step=r||1};p(document).on("focusout",".wpgb-number",function(e){var t=e.target;t.value=l(t,t,!0)}),p(document).on("input",".wpgb-text-number",function(e){var i=e.target;clearTimeout(o),o=setTimeout(function(){var e=i.selectionEnd,t=i.value.length,n=s(i,i),a=l(i,i,!0);i.value=""!==a&&0!==a?a+n:a,i.selectionStart=i.selectionEnd=Math.max(0,e-Math.max(0,t-i.value.length)),r(i)},800)}),p(document).on("focusout",".wpgb-text-number",function(e){var t=e.target,n=s(t,t),a=l(t,t,!0);clearTimeout(o),t.value=""!==a&&0!==a?a+n:a,r(t)});function i(e){var t=e.min,n=e.max,a=100*(e.value-t)/(n-t);a=50<a?a-.2:a+.2,e.style.backgroundSize=(""!==e.nextSibling.value?Math.min(100,wpgb_L10n.RTL?100-a:a):0)+"% 100%"}p(document).on("input change","input.wpgb-range-slider",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=e.target,n=t.nextSibling,a=t.wpgb_unit||s(n,t);i(t),n.value=""===n.value&&0===parseFloat(t.value)?n.value:t.value+a,r(n)}),p(document).on("input",".wpgb-range-slider-value",function(e){var n=e.target,a=n.previousSibling;clearTimeout(o),a.value=l(n,a,!1),i(a),o=setTimeout(function(){var e=n.selectionEnd,t=n.value.length;s(n,a),a.value=l(n,a,!1),p(a).trigger("change"),n.selectionStart=n.selectionEnd=Math.max(0,e-Math.max(0,t-n.value.length))},1e3)}),p(document).on("focusout",".wpgb-range-slider-value",function(e){var t=e.target,n=t.previousSibling;clearTimeout(o),s(t,n),n.value=l(t,n,!1),p(n).trigger("change")});function t(){p(".wpgb-code").each(function(){var t=p(this);if(!t.next(".CodeMirror").length){t.closest("div").add(t).css({display:"block",width:"100%",height:t.data("height")+"px"});var e=CodeMirror.fromTextArea(t[0],{mode:t.data("mode"),value:t.val(),theme:"material",htmlMode:!0,matchClosing:!0,lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,nonEmpty:!1,indentWithTabs:!0,indentUnit:4,scrollbarStyle:"simple",direction:wpgb_L10n.RTL?"rtl":"ltr"});p(e.display.wrapper).find("textarea").attr("aria-label","editor"),e.on("blur",function(e){t.val(e.getValue())}),e.on("change",function(e){t.val(e.getValue()),r(t[0])})}})}t(),window.addEventListener("wpgb_builder.render_field",function(e){t()}),p('select[name="wpgb[post_type][]"]').on("change",function(){n()});var n=function(){var e=p('select[name="wpgb[post_type][]"]').val();p('select[name="wpgb[tax_query][]"]').attr("data-post",e||["post"])};n(),p('select[name="wpgb[meta_key]"]').attr("data-post","key"),p(document).on("click",".wpgb-add-relation",function(e){e.preventDefault();var t=p(this).prev(".wpgb-meta-clauses");t=0<t.length?t.clone():p(this).closest(".wpgb-meta-clauses"),u(t.clone(),p(this))}),p(document).on("click",".wpgb-add-metakey",function(e){e.preventDefault(),u(p(this).prev().clone(),p(this))}),p(document).on("click",".wpgb-delete-metakey",function(e){e.preventDefault(),p(this).parent().remove(),d()});function a(){var e=p('[name="wpgb[type]"]:checked').val();p(".wpgb-table.wpgb-table-card-sizes [data-colname]:not(:first-child)").show(),"justified"===e?p('.wpgb-table.wpgb-table-card-sizes [data-colname="columns"]').hide():p('.wpgb-table.wpgb-table-card-sizes [data-colname="height"]').hide(),"masonry"!==e&&"justified"!==e||p('.wpgb-table.wpgb-table-card-sizes [data-colname="ratio"]').hide()}var u=function(e,t){e.find("input").val(""),e.find("select").each(function(){var e=p(this);e.val(e.find("option").first().val()),e.insertAfter(e.parent())}),e.find("label").each(function(){var e=p(this),t=e.next().find("input, select"),n="wpgb-"+Math.random().toString(36).substr(2,9);e.attr("for",n),t.attr("id",n)}),e.find(".wpgb-add-relation").remove(),e.find(".wpgb-meta-clauses").remove(),e.find(".wpgb-meta-clause").not(":eq(0), .wpgb-add-metakey").remove(),e.find(".wpgb-select-wrapper").remove(),e.insertBefore(t),WPGB_Select_Init(),d()},g=document.querySelector(".wpgb-meta-clauses"),d=function(e,t){t=t||[0];for(var n=0,a=(e=e||document.querySelector(".wpgb-meta-clauses")).children,i=0,r=a.length;i<r;i++){var o=a[i];!o.classList.contains("wpgb-meta-clause")||o.classList.contains("wpgb-add-metakey")?o.classList.contains("wpgb-meta-clauses")&&(g===e?t=[t[0]+1,0]:t.push(0),d(o,t)):(m(o,t,n),n++)}},m=function(e,t,n){var a=e.parentElement.querySelector('select[name*="relation"]'),i=a.name.match(/\[(.*?)\]/g),r=0<t.slice(0,-1).length?"["+t.slice(0,-1).join("][")+"]":"";a.name="wpgb[meta_query]"+r+i.pop(),t[t.length-1]=n;for(var o=e.querySelectorAll("input, select"),l=0,s=o.length;l<s;l++)i=(a=o[l]).name.match(/\[(.*?)\]/g),r=0<t.length?"["+t.join("][")+"]":"",a.name="wpgb[meta_query]"+r+i.pop();return t};p(document).on("change",'[name="wpgb[type]"]',function(){a()}),p('input[name="wpgb[card_sizes][0][browser]"]').prop("disabled",!0).val(9999),a(),p(".wpgb-layout-facets").length&&p(".wpgb-layout-facets").sortable({items:".wpgb-layout-facet",connectWith:".wpgb-layout-facets",appendTo:p("#wpgb"),helper:"clone",revert:150,start:function(e,t){t.item.show();var n=parseFloat(getComputedStyle(t.item[0]).width);t.helper.css("width",n),t.placeholder.css("width",n),t.item.hide()},receive:function(e,t){var n=t.item.find("input"),a=n.closest("ul");a.closest(".wpgb-available-facets").length?n.removeAttr("name"):n.attr("name","wpgb[grid_layout]["+a.data("area")+"][facets][]"),t.item.removeAttr("style"),b()}}).disableSelection();var b=function(){p(".wpgb-layout .wpgb-layout-facets").each(function(){var e=p(this).find("li");e.first()[1<e.length?"fadeOut":"fadeIn"](150)})};b(),p('.wpgb-layout-buttons [data-button="settings"]').on("click",function(e){var t=p(this).closest(".wpgb-layout-area").find("> .wpgb-layout-style");t.attr("style")?t.removeAttr("style"):(p(".wpgb-layout-style").removeAttr("style"),t.show())}),p(document).on("click",function(e){p(e.target).is('[data-button="settings"]')||p(e.target).closest(".wpgb-layout-style").length||p(e.target).closest(".wpgb-select-results").length||p(".wpgb-layout-style").removeAttr("style")}),p('.wpgb-layout-buttons [data-button^="flex-"], .wpgb-layout-buttons [data-button^="center"]').on("click",function(){var e=p(this),t=e.data("button").replace("text-",""),n=e.closest(".wpgb-layout-area");n.find(".wpgb-layout-facets").css("justify-content",t||""),n.find('[type="radio"][value="'+t+'"]').prop("checked",!0).trigger("change"),e.prevAll().add(e.nextAll()).removeClass("wpgb-layout-button-active"),e.addClass("wpgb-layout-button-active")});function f(){var e=h.val(),t=p('[name="wpgb[transition]"]').val(),n=p('[name="wpgb[timing_function]"]').val();e&&w.hasOwnProperty(e)&&(e=w[e]).hasOwnProperty("hidden")&&e.hasOwnProperty("visible")&&(e.hidden.transition="none",p(".wpgb-animation-placeholder").removeAttr("style"),p(".wpgb-animation-placeholder").css(e.hidden),clearTimeout(v),v=setTimeout(function(){"custom"===n&&(n=p('[name="wpgb[cubic_bezier_function]"]').val()),e.visible.transition="all "+parseInt(t)+"ms "+n,p(".wpgb-animation-placeholder").css(e.visible)},50))}var v,h=p('select[name="wpgb[animation]"]'),w=0<h.length?wpgb_animations_L10n:{};p('[name="wpgb[animation]"], [name="wpgb[transition]"], [name="wpgb[timing_function]"], [name="wpgb[cubic_bezier_function]"]').on("change",function(){f()}),p(".wpgb-run-animation").on("click",function(e){e.preventDefault(),f()});function y(e){A.css({color:e,borderColor:e,backgroundColor:e})}function _(e){k.css({transform:"scale("+parseFloat(e)+")"})}var k=p("."+p('[name="wpgb[loader_type]"]:checked').val()),A=k.find("div"),x=p('[name="wpgb[loader_color]"]'),S=p('[name="wpgb[loader_type]"]'),E=p('[name="wpgb[loader_size]"]');S.on("change",function(){k.removeAttr("style"),A.removeAttr("style"),k=p("."+p(this).val().trim()),A=k.find("div"),y(x.val()),_(E.val())}),E.on("change",function(){_(p(this).val())}),x.on("change",function(){y(p(this).val())}),y(x.val()),_(E.val());function C(e){e.find("tbody tr").each(function(n){p(this).find("td").each(function(){var e=p(this).find("input, select"),t="wpgb-"+Math.random().toString(36).substr(2,9);p(this).find("label").attr("for",t),e.each(function(){var e=p(this)[0].name;p(this)[0].name=e.replace(/\[(\d+)\]/g,"["+n+"]"),"hidden"!==p(this).attr("type")&&(p(this)[0].id=t)})})})}var T=p(".wpgb-repeater tbody");if(T.length){var O=p("<tr>");T.sortable({axis:"y",handle:".wpgb-repeater-sort",revert:150,sort:function(e,t){if(p(this).find("tr").length<3)return t.item.removeAttr("style"),t.item.removeAttr("class"),void t.placeholder.css("display","none");p(".wpgb-repeater-sort").addClass("wpgb-dragging"),O.insertAfter(t.item)},stop:function(e,t){p(".wpgb-repeater-sort").removeClass("wpgb-dragging"),O.remove(),C(p(this).closest(".wpgb-repeater"))}}).disableSelection()}p(document).on("click",".wpgb-add-row",function(e){e.preventDefault();var t=p(this).prev(".wpgb-table-wrapper").find(".wpgb-repeater"),n=t.find("tbody"),a=n.find("tr");if(a.length>=t.attr("data-limit")-1&&p(this).hide(),!(a.length>=t.attr("data-limit"))){var i=a.first().clone();i.find(".ui-sortable-handle").show(),i.find("input").val(""),i.find("select").each(function(){var e=p(this);e.val(e.find("option").first().val()),e.insertAfter(e.parent())}),i.find(".wpgb-select-wrapper").remove(),i.find(".wpgb-color-holder").remove(),i.find(".wpgb-color-picker-preview").removeAttr("style"),n.append(i),i.find(".wpgb-range-slider-value").trigger("input"),i.find("input.wpgb-range-slider").trigger("input"),WPGB_Select_Init(),WPGB_Gradient_Init(),C(t)}}),p(document).on("click",".wpgb-delete-row",function(e){var t=p(this).closest(".wpgb-repeater"),n=t.find("tbody").find("tr").length,a=p(this).closest("tr");t.next(".wpgb-add-row").show(),n<2||(a.remove(),C(t))})}(jQuery);